# LP Module - æµåŠ¨æ€§æ± ä¸è´¨æŠ¼æŒ–çŸ¿æ¨¡å—

åŸºäº Solana åŒºå—é“¾çš„ DeFi æµåŠ¨æ€§æŒ–çŸ¿æ¨¡å—ï¼Œæä¾›å®Œæ•´çš„æµåŠ¨æ€§æ± ã€è´¨æŠ¼å’Œå¥–åŠ±åˆ†é…åŠŸèƒ½ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ DeFi æµåŠ¨æ€§æŒ–çŸ¿ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

- âœ… **æµåŠ¨æ€§æ± ç®¡ç†** - ç”¨æˆ·å­˜å…¥ wrappedUSDCï¼Œè·å¾— LP Token
- âœ… **è´¨æŠ¼æŒ–çŸ¿** - è´¨æŠ¼ LP Token èµšå– SOL å¥–åŠ±
- âœ… **åŒé‡å¥–åŠ±æœºåˆ¶** - å›ºå®šé€Ÿç‡ & æŒ‰å—åŠ¨æ€æ’æ”¾
- â³ **æ•°æ®é‡‡é›†** - åŸºäº ClickHouse çš„é“¾ä¸Šæ•°æ®ç´¢å¼•ï¼ˆå¾…å®ç°ï¼‰
- âœ… **å®Œæ•´æ–‡æ¡£** - è®¾è®¡æ–‡æ¡£ã€å¼€å‘æŒ‡å—ã€API å‚è€ƒ

## ğŸ“Š å¼€å‘è¿›åº¦

**å½“å‰é˜¶æ®µ**: Phase 1 âœ… å·²å®Œæˆ

- âœ… å¼€å‘ç¯å¢ƒæ­å»ºï¼ˆSolana CLI 2.3.13, Anchor 0.32.1ï¼‰
- âœ… æ ¸å¿ƒçŠ¶æ€ç»“æ„å®šä¹‰
- âœ… å¥–åŠ±è®¡ç®—å™¨å®ç°
- âœ… Initialize æŒ‡ä»¤å®ç°
- âœ… é¦–æ¬¡æˆåŠŸç¼–è¯‘

**ä¸‹ä¸€é˜¶æ®µ**: Phase 2 - æµåŠ¨æ€§æ± åŠŸèƒ½ï¼ˆDeposit/Withdrawï¼‰

è¯¦è§ï¼š[06_å¼€å‘è¿›åº¦æŠ¥å‘Š_Phase1å®Œæˆ.md](docs/06_å¼€å‘è¿›åº¦æŠ¥å‘Š_Phase1å®Œæˆ.md)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker 20.10+
- Docker Compose 2.0+

### æ–¹æ³• 1: ä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰

```bash
# 1. æ„å»ºå¹¶å¯åŠ¨å¼€å‘ç¯å¢ƒ
./scripts/dev.sh build
./scripts/dev.sh start

# 2. è¿›å…¥å¼€å‘å®¹å™¨
./scripts/dev.sh shell

# 3. è®¾ç½® Solana ç¯å¢ƒï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
/workspace/scripts/setup-dev-env.sh

# 4. ç¼–è¯‘ Anchor é¡¹ç›®
cd /workspace/lp-staking
anchor build
```

### æ–¹æ³• 2: æœ¬åœ°å¼€å‘

```bash
# 1. å®‰è£… Solana å·¥å…·é“¾
./scripts/setup-dev-env.sh

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd lp-staking

# 3. å¯åŠ¨æµ‹è¯•éªŒè¯å™¨ï¼ˆæ–°ç»ˆç«¯ï¼‰
solana-test-validator --reset

# 4. ç¼–è¯‘é¡¹ç›®
anchor build

# 5. è¿è¡Œæµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
anchor test
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
lp_module/
â”œâ”€â”€ lp-staking/              # â­ Anchor æ™ºèƒ½åˆçº¦é¡¹ç›®
â”‚   â”œâ”€â”€ programs/
â”‚   â”‚   â””â”€â”€ lp-staking/     # Rust ç¨‹åºæºç 
â”‚   â”‚       â”œâ”€â”€ src/
â”‚   â”‚       â”‚   â”œâ”€â”€ lib.rs               # ç¨‹åºå…¥å£
â”‚   â”‚       â”‚   â”œâ”€â”€ constants.rs         # å¸¸é‡å®šä¹‰
â”‚   â”‚       â”‚   â”œâ”€â”€ errors.rs            # é”™è¯¯ç±»å‹
â”‚   â”‚       â”‚   â”œâ”€â”€ state/               # çŠ¶æ€è´¦æˆ·
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ pool_state.rs    # æ± å­çŠ¶æ€
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ user_position.rs # ç”¨æˆ·ä»“ä½
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ reward_config.rs # å¥–åŠ±é…ç½®
â”‚   â”‚       â”‚   â”œâ”€â”€ instructions/        # æŒ‡ä»¤å®ç°
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ initialize.rs    # åˆå§‹åŒ–
â”‚   â”‚       â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚       â”‚       â””â”€â”€ reward_calculator.rs
â”‚   â”‚       â””â”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ tests/              # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ target/             # ç¼–è¯‘è¾“å‡º
â”‚   â”‚   â”œâ”€â”€ deploy/         # éƒ¨ç½²æ–‡ä»¶ï¼ˆ.soï¼‰
â”‚   â”‚   â””â”€â”€ idl/            # IDL JSON
â”‚   â””â”€â”€ Anchor.toml         # Anchor é…ç½®
â”‚
â”œâ”€â”€ docs/                   # ğŸ“š å®Œæ•´æ–‡æ¡£
â”‚   â”œâ”€â”€ 01_æµåŠ¨æ€§æ± ä¸è´¨æŠ¼æŒ–çŸ¿æ¨¡å—_æ•´ä½“è®¾è®¡æ–‡æ¡£.md
â”‚   â”œâ”€â”€ 02_Dockerå¼€å‘ç¯å¢ƒä½¿ç”¨æ–‡æ¡£.md
â”‚   â”œâ”€â”€ 03_ç ”å‘è®¡åˆ’ä¸å¼€å‘æŒ‡å—.md
â”‚   â”œâ”€â”€ 04_Anchoré¡¹ç›®ç»“æ„ä¸ä»£ç è¯´æ˜.md
â”‚   â”œâ”€â”€ 05_Solanaå’ŒAnchorå¼€å‘ç¯å¢ƒå®‰è£…æŒ‡å—.md
â”‚   â”œâ”€â”€ 06_å¼€å‘è¿›åº¦æŠ¥å‘Š_Phase1å®Œæˆ.md
â”‚   â””â”€â”€ 07_å¿«é€Ÿå‚è€ƒæ‰‹å†Œ.md
â”‚
â”œâ”€â”€ scripts/                # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ dev.sh             # Docker ç¯å¢ƒç®¡ç†
â”‚   â””â”€â”€ setup-dev-env.sh   # ç¯å¢ƒè‡ªåŠ¨å®‰è£…
â”‚
â”œâ”€â”€ Dockerfile             # Docker é•œåƒå®šä¹‰
â”œâ”€â”€ docker-compose.yml     # Docker Compose é…ç½®
â””â”€â”€ README.md              # æœ¬æ–‡ä»¶
```

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### Docker ç¯å¢ƒç®¡ç†

```bash
./scripts/dev.sh build      # æ„å»ºé•œåƒ
./scripts/dev.sh start      # å¯åŠ¨ç¯å¢ƒ
./scripts/dev.sh stop       # åœæ­¢ç¯å¢ƒ
./scripts/dev.sh shell      # è¿›å…¥å®¹å™¨
./scripts/dev.sh restart    # é‡å¯ç¯å¢ƒ
```

### Anchor é¡¹ç›®å¼€å‘

```bash
cd /workspace/lp-staking

# ç¼–è¯‘é¡¹ç›®
anchor build

# è¿è¡Œæµ‹è¯•
anchor test

# éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
anchor deploy

# æŸ¥çœ‹ç¨‹åºæ—¥å¿—
solana logs

# æŸ¥çœ‹ç¨‹åº ID
solana address -k target/deploy/lp_staking-keypair.json
```

### Solana å·¥å…·

```bash
# æŸ¥çœ‹ä½™é¢
solana balance

# ç©ºæŠ•æµ‹è¯• SOL
solana airdrop 10

# æŸ¥çœ‹é…ç½®
solana config get

# æŸ¥çœ‹è´¦æˆ·
solana account <address>
```

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### çŠ¶æ€è´¦æˆ·

| è´¦æˆ·ç±»å‹ | PDA Seeds | å¤§å° | è¯´æ˜ |
|---------|----------|------|------|
| **PoolState** | `["pool_state"]` | 193 å­—èŠ‚ | æ± å­æ ¸å¿ƒçŠ¶æ€ |
| **UserPosition** | `["user_position", user, pool]` | 129 å­—èŠ‚ | ç”¨æˆ·æŒä»“ä¿¡æ¯ |
| **RewardConfig** | `["reward_config", pool]` | 106 å­—èŠ‚ | å¥–åŠ±é…ç½® |

### å·²å®ç°æŒ‡ä»¤

| æŒ‡ä»¤ | çŠ¶æ€ | åŠŸèƒ½ |
|-----|------|-----|
| `initialize` | âœ… å·²å®Œæˆ | åˆå§‹åŒ–æ± å­å’Œå¥–åŠ±ç³»ç»Ÿ |
| `deposit` | â³ å¼€å‘ä¸­ | å­˜å…¥ USDCï¼Œè·å¾— LP Token |
| `withdraw` | ğŸ“‹ è®¡åˆ’ä¸­ | èµå› LP Tokenï¼Œæå– USDC |
| `stake` | ğŸ“‹ è®¡åˆ’ä¸­ | è´¨æŠ¼ LP Token å¼€å§‹æŒ–çŸ¿ |
| `unstake` | ğŸ“‹ è®¡åˆ’ä¸­ | è§£é™¤è´¨æŠ¼ LP Token |
| `claim` | ğŸ“‹ è®¡åˆ’ä¸­ | é¢†å–ç´¯è®¡å¥–åŠ± |

### å¥–åŠ±æœºåˆ¶

#### å›ºå®šé€Ÿç‡æ’æ”¾
```
user_reward = (user_staked / total_staked) Ã— emission_rate Ã— time_elapsed
```

#### æŒ‰å—åŠ¨æ€æ’æ”¾
```
current_rate = initial_rate Ã— (decay_factor / 10000) ^ period
user_reward = (user_staked / total_staked) Ã— current_rate Ã— blocks_elapsed
```

## ğŸ“– æ–‡æ¡£ç´¢å¼•

### è®¾è®¡æ–‡æ¡£
- [01_æ•´ä½“è®¾è®¡æ–‡æ¡£](docs/01_æµåŠ¨æ€§æ± ä¸è´¨æŠ¼æŒ–çŸ¿æ¨¡å—_æ•´ä½“è®¾è®¡æ–‡æ¡£.md) - å®Œæ•´ç³»ç»Ÿè®¾è®¡
- [03_ç ”å‘è®¡åˆ’ä¸å¼€å‘æŒ‡å—](docs/03_ç ”å‘è®¡åˆ’ä¸å¼€å‘æŒ‡å—.md) - è¯¦ç»†å¼€å‘è®¡åˆ’

### æŠ€æœ¯æ–‡æ¡£
- [04_Anchoré¡¹ç›®ç»“æ„ä¸ä»£ç è¯´æ˜](docs/04_Anchoré¡¹ç›®ç»“æ„ä¸ä»£ç è¯´æ˜.md) - ä»£ç æ¶æ„
- [05_Solanaå’ŒAnchorå¼€å‘ç¯å¢ƒå®‰è£…æŒ‡å—](docs/05_Solanaå’ŒAnchorå¼€å‘ç¯å¢ƒå®‰è£…æŒ‡å—.md) - ç¯å¢ƒæ­å»º
- [07_å¿«é€Ÿå‚è€ƒæ‰‹å†Œ](docs/07_å¿«é€Ÿå‚è€ƒæ‰‹å†Œ.md) - å¿«é€ŸæŸ¥è¯¢

### è¿›åº¦æŠ¥å‘Š
- [06_å¼€å‘è¿›åº¦æŠ¥å‘Š_Phase1å®Œæˆ](docs/06_å¼€å‘è¿›åº¦æŠ¥å‘Š_Phase1å®Œæˆ.md) - æœ€æ–°è¿›åº¦

### ç¯å¢ƒæ–‡æ¡£
- [02_Dockerå¼€å‘ç¯å¢ƒä½¿ç”¨æ–‡æ¡£](docs/02_Dockerå¼€å‘ç¯å¢ƒä½¿ç”¨æ–‡æ¡£.md) - Docker ä½¿ç”¨è¯´æ˜

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
# è¿è¡Œ Rust å•å…ƒæµ‹è¯•
cd lp-staking
cargo test --package lp-staking
```

### é›†æˆæµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
```bash
# è¿è¡Œ Anchor é›†æˆæµ‹è¯•
anchor test
```

## ğŸ” ç¨‹åºä¿¡æ¯

```
ç¨‹åº ID:   21HQd5MFf1hK9skAe7Hctp535318QQLTQEn29kMeYAP8
ç‰ˆæœ¬:      0.1.0
Anchor:    0.32.1
Solana:    2.3.13
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**ç¼–è¯‘é”™è¯¯**
```bash
anchor clean
cargo clean
anchor build
```

**æµ‹è¯•éªŒè¯å™¨æ— æ³•å¯åŠ¨**
```bash
pkill solana-test-validator
solana-test-validator --reset
```

**è´¦æˆ·ä¸å­˜åœ¨**
```bash
solana airdrop 10
```

æ›´å¤šé—®é¢˜è¯·å‚è€ƒï¼š[07_å¿«é€Ÿå‚è€ƒæ‰‹å†Œ](docs/07_å¿«é€Ÿå‚è€ƒæ‰‹å†Œ.md)

## ğŸ—ºï¸ å¼€å‘è·¯çº¿å›¾

- [x] **Phase 1**: é¡¹ç›®åˆå§‹åŒ–ä¸ç¯å¢ƒæ­å»º âœ…
- [ ] **Phase 2**: æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆDeposit/Withdrawï¼‰â³
- [ ] **Phase 3**: è´¨æŠ¼åŠŸèƒ½ï¼ˆStake/Unstake/Claimï¼‰
- [ ] **Phase 4**: æ•°æ®ç´¢å¼•æœåŠ¡ï¼ˆClickHouseï¼‰
- [ ] **Phase 5**: é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–
- [ ] **Phase 6**: Devnet éƒ¨ç½²

## ğŸ“ è®¸å¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### è´¡çŒ®æŒ‡å—
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®è´Ÿè´£äºº: [å¾…å®š]
- æŠ€æœ¯æ”¯æŒ: [å¾…å®š]
- æ–‡æ¡£ç»´æŠ¤: LP Module Dev Team

---

**æœ€åæ›´æ–°**: 2025-10-31  
**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ æ´»è·ƒå¼€å‘ä¸­  
**å®Œæˆåº¦**: ~15%
